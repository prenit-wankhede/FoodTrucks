require 'test_helper'

class LocationDataCenterTest < ActionDispatch::IntegrationTest
  test "should get location data from data center" do
    trucks = ::LocationDataCenter.get_nearby_food_trucks(37.78, -122.43, 500).to_json
    @sample_response = [{"address":"Assessors Block 0733/Lot010","applicant":"Bob Johnson","approved":"2014-02-25T00:00:00.000","block":"0733","blocklot":"0733010","cnn":"0","dayshours":"Mo-Su:10AM-7PM","expirationdate":"2015-03-15T00:00:00.000","facilitytype":"Truck","fooditems":"Watermelon","latitude":"37.782143532929","location":{"type":"Point","coordinates":[-122.430449785949,37.782143532929]},"longitude":"-122.430449785949","lot":"010","objectid":"519938","permit":"14MFF-0009","priorpermit":"1","received":"2014-02-25","schedule":"http://bsm.sfdpw.org/PermitsTracker/reports/report.aspx?title=schedule\u0026report=rptSchedule\u0026params=permit=14MFF-0009\u0026ExportPDF=1\u0026Filename=14MFF-0009_schedule.pdf","status":"EXPIRED","x":"6003818.547","y":"2113011.835"},{"address":"1652 EDDY ST","applicant":"Mang Hang Catering","block":"0730","blocklot":"0730 044","cnn":"5073000","dayshours":"Mo-Fr:11AM-12PM","expirationdate":"2018-03-15T00:00:00.000","facilitytype":"Truck","fooditems":"COLD TRUCK. Deli: bbq chicken skewer: Chinese spring roll: Chinese fried rice/noodle: fried chicken leg/wing: bbq chicken sandwich: chicken cheese burger: burrito: lumpia. Snack: sunflower seeds: muffins: chips: snickers: kit-kat: 10 types of chocolate. Drinks: Coke: 7-Up: Dr. Pepper: Pepsi: Redbull: Vitamin Water: Rockstar: Coconut Juice: Water. Hot drinks: coffee: tea.","latitude":"37.7815967457602","location":{"type":"Point","coordinates":[-122.43485778844,37.78159674576]},"locationdescription":"EDDY ST: STEINER ST to PIERCE ST (1600 - 1699)","longitude":"-122.43485778844","lot":"044","objectid":"1047079","permit":"17MFF-0200","priorpermit":"1","received":"2017-12-13","schedule":"http://bsm.sfdpw.org/PermitsTracker/reports/report.aspx?title=schedule\u0026report=rptSchedule\u0026params=permit=17MFF-0200\u0026ExportPDF=1\u0026Filename=17MFF-0200_schedule.pdf","status":"REQUESTED","x":"6002540.818","y":"2112839.086"},{"address":"1346 EDDY ST","applicant":"Anas Goodies Catering","approved":"2017-03-08T00:00:00.000","block":"0733","blocklot":"0733014","cnn":"5070000","dayshours":"Mo-Fr:8AM-9AM","expirationdate":"2018-07-15T00:00:00.000","facilitytype":"Truck","fooditems":"Cold Truck: Sandwiches: Noodles:  Pre-packaged Snacks: Candy: Desserts Various Beverages","latitude":"37.7818671175741","location":{"type":"Point","coordinates":[-122.429885247603,37.781867117574]},"locationdescription":"EDDY ST: BUCHANAN ST to WEBSTER ST (1300 - 1399)","longitude":"-122.429885247603","lot":"014","objectid":"934642","permit":"17MFF-0111","priorpermit":"1","received":"2017-02-13","schedule":"http://bsm.sfdpw.org/PermitsTracker/reports/report.aspx?title=schedule\u0026report=rptSchedule\u0026params=permit=17MFF-0111\u0026ExportPDF=1\u0026Filename=17MFF-0111_schedule.pdf","status":"APPROVED","x":"6003979.58488","y":"2112907.84293"},{"address":"1003 TURK ST","applicant":"John's Catering #5","approved":"2017-03-09T00:00:00.000","block":"0759","blocklot":"0759001","cnn":"12726000","dayshours":"Mo-Fr:8AM-9AM/11AM-12PM","expirationdate":"2018-07-15T00:00:00.000","facilitytype":"Truck","fooditems":"Cold Truck: Soda:Chips:Candy: Cold/Hot Sandwiches: Donuts.  (Pitco Wholesale)","latitude":"37.7808684365681","location":{"type":"Point","coordinates":[-122.425467726618,37.780868436568]},"locationdescription":"TURK ST: GOUGH ST to LAGUNA ST (900 - 1099)","longitude":"-122.425467726618","lot":"001","objectid":"934423","permit":"17MFF-0084","priorpermit":"1","received":"2017-02-13","schedule":"http://bsm.sfdpw.org/PermitsTracker/reports/report.aspx?title=schedule\u0026report=rptSchedule\u0026params=permit=17MFF-0084\u0026ExportPDF=1\u0026Filename=17MFF-0084_schedule.pdf","status":"APPROVED","x":"6005248.473","y":"2112517.984"}].to_json
    assert trucks.length > 0
    assert trucks == @sample_response
  end
end
